(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){e.exports=n(24)},23:function(e,t,n){},24:function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}n.r(t);var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"webgl",value:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}},{key:"getWebGLErrorMessage",value:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000000">here</a>.'].join("\n"),e}},{key:"addGetWebGLMessage",value:function(e){var t,n,a;t=void 0!==(e=e||{}).parent?e.parent:document.body,n=void 0!==e.id?e.id:"oldie",(a=this.getWebGLErrorMessage()).id=n,t.appendChild(a)}}])&&a(t.prototype,n),r&&a(t,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._loading=t.getElementById("loading"),this._saveStyle(),this._progress=t.getElementById("progress")}var t,n,a;return t=e,(n=[{key:"_saveStyle",value:function(){this._old_style=this._loading.style.display}},{key:"hideLoading",value:function(){this._saveStyle(),this._loading.style.display="none"}},{key:"showLoading",value:function(){this._loading.style.display=this._old_style}},{key:"progress",value:function(e,t){console.log(e,t),this._progress.style.width=e+"%"}}])&&o(t.prototype,n),a&&o(t,a),e}(),s=n(4),u=n.n(s),l=n(5),c=n.n(l);function h(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._audioConfig=t,this._audioInited=!1;this._audioManager=new u.a(["speech","music"]),this._audioManager.settings.audioPath="assets/audio/",this._audioManager.settings.getFileUri=this._getAudioPath,this._currentSound=void 0,this._preloadMusic(this._audioManager),this._webVoiceCommand=c.a}var t,n,a;return t=e,(n=[{key:"_getAudioPath",value:function(e,t){return e+t}},{key:"mute",value:function(){this._audioInited&&this._audioManager.setMute()}},{key:"unmute",value:function(){this._audioInited||(this._audioManager.init(),this._setAudioVolume(this._audioManager),this._playBackgroundAudio(this._audioManager),this._audioInited=!0,this._initMicrophone())}},{key:"_setAudioVolume",value:function(e){e.setVolume("speech",.4),e.setVolume("music",.03)}},{key:"_preloadMusic",value:function(e){e.createSound(this._getAudio("background")).load()}},{key:"_getAudio",value:function(e){return e+".mp3"}},{key:"_playBackgroundAudio",value:function(e){}},{key:"say",value:function(e){this.stopSpeaking();var t=this._playSound(this._audioManager,"speech",e);return this._currentSound=t,t}},{key:"_playSound",value:function(e,t,n){return e.playSound(t,this._getAudio(n))}},{key:"stopSpeaking",value:function(){void 0!==this._currentSound&&(this._currentSound.stop(),this._currentSound=void 0)}},{key:"_initMicrophone",value:function(){var e=this,t=this._webVoiceCommand;t.setOptions({persistentListening:!0,listenOnLoad:!1,language:"ru-RU"}),t.results((function(t){console.log(t);var n,a=h(t);try{for(a.s();!(n=a.n()).done;){var r=n.value.toLowerCase();console.log(r),-1!==r.indexOf("привет")&&e.say("hello")}}catch(e){a.e(e)}finally{a.f()}}))}}])&&f(t.prototype,n),a&&f(t,a),e}();function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this._soundProducer=new v({background:"bensound-jazzyfrenchy.mp3",words:[{actionWord:{name:"Расскажи",options:[{word:"квартире",alternateWord:[]},{word:"комнате",alternateWord:[]}]}},{actionWord:{name:"Здравствуйте",options:[]}}]}),this._soundButton=t.getElementById("soundButton"),this._soundState=!1,this._setButtonState(this._soundState),this._soundButton.addEventListener?this._soundButton.addEventListener("click",(function(){var e=n._swapState();n._setButtonState(e)})):this._soundButton.attachEvent&&this._soundButton.attachEvent("onclick",(function(){var e=n._swapState();n._setButtonState(e)}))}var t,n,a;return t=e,(n=[{key:"say",value:function(e,t){var n=this._soundProducer.say(e);t("speak"),n.onEnd=function(){t("stop"),console.log("sound playback ended"),n.onEnd=null}}},{key:"mute",value:function(){this._soundProducer.stopSpeaking()}},{key:"_swapState",value:function(){return this._soundState=!this._soundState,this._soundState}},{key:"_setButtonState",value:function(e){var t=this._soundButton.firstChild;e?(t.data="MUTE",this._soundProducer.unmute()):(t.data="UNMUTE",this._soundProducer.mute())}}])&&m(t.prototype,n),a&&m(t,a),e}(),y=n(0),_=n(6);n(25);function g(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var w=function(){function e(t,n,a){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=n,this.container=a,this.threeRenderer=new y.Yb({antialias:!0}),this.threeRenderer.setClearColor(n.fog.color),this.threeRenderer.setPixelRatio(window.devicePixelRatio),a.appendChild(this.threeRenderer.domElement),this.threeRenderer.shadowMap.enabled=!0,this.threeRenderer.shadowMap.type=y.mb,t.maxAnisotropy=this.threeRenderer.capabilities.getMaxAnisotropy(),this.updateSize(),this.threeRenderer.outputEncoding=y.Zb,this.threeRenderer.xr.enabled=!0,document.body.appendChild(_.a.createButton(this.threeRenderer)),document.addEventListener("DOMContentLoaded",(function(){return r.updateSize()}),!1),window.addEventListener("resize",(function(){return r.updateSize()}),!1)}var t,n,a;return t=e,(n=[{key:"updateSize",value:function(){this.threeRenderer.setSize(this.container.offsetWidth,this.container.offsetHeight)}},{key:"render",value:function(e,t){this.threeRenderer.render(e,t)}}])&&g(t.prototype,n),a&&g(t,a),e}();function b(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var k=function(){function e(t,n){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=n.domElement.width,o=n.domElement.height;this.threeCamera=new y.nb(t.camera.fov,r/o,t.camera.near,t.camera.far),this.threeCamera.position.set(t.camera.posX,t.camera.posY,t.camera.posZ),this.threeCamera.lookAt(0,0,0),this.updateSize(n),window.addEventListener("resize",(function(){return a.updateSize(n)}),!1)}var t,n,a;return t=e,(n=[{key:"updateSize",value:function(e){this.threeCamera.aspect=e.domElement.width/e.domElement.height,this.threeCamera.updateProjectionMatrix()}}])&&b(t.prototype,n),a&&b(t,a),e}(),S=n(7);function x(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var A=function(){function e(t,n,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.threeControls=new S.a(n,a),this.init(t)}var t,n,a;return t=e,(n=[{key:"init",value:function(e){this.threeControls.target.set(e.controls.target.x,e.controls.target.y,e.controls.target.z),this.threeControls.autoRotate=e.controls.autoRotate,this.threeControls.autoRotateSpeed=e.controls.autoRotateSpeed,this.threeControls.rotateSpeed=e.controls.rotateSpeed,this.threeControls.zoomSpeed=e.controls.zoomSpeed,this.threeControls.minDistance=e.controls.minDistance,this.threeControls.maxDistance=e.controls.maxDistance,this.threeControls.minPolarAngle=e.controls.minPolarAngle,this.threeControls.maxPolarAngle=e.controls.maxPolarAngle,this.threeControls.enableDamping=e.controls.enableDamping,this.threeControls.enableZoom=e.controls.enableZoom,this.threeControls.dampingFactor=e.controls.dampingFactor,this.threeControls.keys={LEFT:0,RIGHT:0,UP:0,BOTTOM:0}}}])&&x(t.prototype,n),a&&x(t,a),e}(),C=n(8);function M(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var P=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initSky(t)}var t,n,a;return t=e,(n=[{key:"_initSky",value:function(e){var t=new C.a;t.scale.setScalar(45e4),e.add(t);var n=new y.Vb,a=10,r=3,o=.005,i=.7,s=.49,u=.25,l=t.material.uniforms;l.turbidity.value=a,l.rayleigh.value=r,l.mieCoefficient.value=o,l.mieDirectionalG.value=i;var c=Math.PI*(s-.5),h=2*Math.PI*(u-.5);n.x=Math.cos(h),n.y=Math.sin(h)*Math.sin(c),n.z=Math.sin(h)*Math.cos(c),l.sunPosition.value.copy(n)}}])&&M(t.prototype,n),a&&M(t,a),e}();function E(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var j=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keys={};var n=new Map,a=function(e,a){t.keys[a]={down:!1,justPressed:!1},n.set(e,a)},r=function(e,a){var r=n.get(e);r&&function(e,n){var a=t.keys[e];a.justPressed=n&&!a.down,a.down=n}(r,a)};a(65,"left"),a(68,"right"),a(87,"up"),a(83,"down"),a(69,"action"),a(32,"action2"),a(70,"speak"),window.addEventListener("keydown",(function(e){r(e.keyCode,!0)})),window.addEventListener("keyup",(function(e){r(e.keyCode,!1)}))}var t,n,a;return t=e,(n=[{key:"update",value:function(){for(var e=0,t=Object.values(this.keys);e<t.length;e++){var n=t[e];n.justPressed&&(n.justPressed=!1)}}}])&&E(t.prototype,n),a&&E(t,a),e}(),O=n(9),z=n(10),B=n.n(z);function T(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function D(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var W=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,(n=[{key:"generate",value:function(e,t,n,a){var r,o=[],i=(this._calcCenter(e),T(e));try{for(i.s();!(r=i.n()).done;){var s=r.value,u=this._generateShape(s.points,.01,a.getTexture("floor"));u.userData={roomId:s.type},o.push(u)}}catch(e){i.e(e)}finally{i.f()}var l,c=T(t);try{for(c.s();!(l=c.n()).done;){var h=l.value,d=this._generateShape(h,-2,a.getTexture("door"));o.push(d)}}catch(e){c.e(e)}finally{c.f()}return o}},{key:"_generateShape",value:function(e,t,n){var a,r=[],o=T(e);try{for(o.s();!(a=o.n()).done;){var i=a.value;r.push(new y.Ub(this._transform(i[0]),this._transform(i[1])))}}catch(e){o.e(e)}finally{o.f()}var s=new y.Db(r),u={depth:t,bevelEnabled:!1},l=new y.w(s,u),c=new y.Z(l,new y.bb({map:n,side:y.s}));return c.receiveShadow=!0,c.rotateX(Math.PI/2),c}},{key:"_calcCenter",value:function(e){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var a,r=T(t.value.points);try{for(r.s();!(a=r.n()).done;)a.value}catch(e){r.e(e)}finally{r.f()}}}catch(e){n.e(e)}finally{n.f()}}},{key:"generate2",value:function(e,t){var n=this._convertToVertices(e),a=new y.l,r=new Float32Array(n);a.setAttribute("position",new y.k(r,3));var o=new y.ab({color:16711680,side:y.s}),i=new y.Z(a,o);i.scale.set(.01,.01,.01);var s=this._moveToCenter(i);return[i,this._generateWallExtrude(s)]}},{key:"_generateWallExtrude",value:function(e){var t=[];t.push(new y.Ub(e.min.x,e.min.z)),t.push(new y.Ub(e.min.x,e.max.z)),t.push(new y.Ub(e.max.x,e.max.z)),t.push(new y.Ub(e.max.x,e.min.z));var n=new y.Db(t),a=new y.w(n,{depth:-2.6,bevelEnabled:!1}),r=new y.Z(a,new y.cb({side:y.s}));return r.rotateX(Math.PI/2),r.translateZ(-2),r}},{key:"_generateWall",value:function(){var e=new y.Db(this._convertToVector(walls)),t=new y.w(e,{depth:-260}),n=new y.Z(t,new y.cb({side:y.s}));n.rotateY(Math.PI/2),n.scale.set(.01,.01,.01),n.translateX(-cent.x),n.translateZ(-cent.z)}},{key:"_generatePlane",value:function(e,t){var n,a=[],r=T(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;a.push(o[0]),a.push(o[1])}}catch(e){r.e(e)}finally{r.f()}var i,s=T(B()(a));try{for(s.s();!(i=s.n()).done;){var u=2*i.value,l=a[u],c=a[u+1];e.push(-c),e.push(0),e.push(l)}}catch(e){s.e(e)}finally{s.f()}}},{key:"_convertToVertices",value:function(e){var t,n=[],a=T(e);try{for(a.s();!(t=a.n()).done;){var r=t.value.points;this._generatePlane(n,r)}}catch(e){a.e(e)}finally{a.f()}return n}},{key:"_convertToVector",value:function(e){var t,n=[],a=5,r=T(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(n.push(new y.Ub(o[0],o[1])),a++>8)break}}catch(e){r.e(e)}finally{r.f()}return console.log(n),n}},{key:"_moveToCenter",value:function(e){var t=(new y.g).setFromObject(e),n=t.getCenter(new y.Vb);return t.getSize(new y.Vb),console.log(t),console.log(n),e.translateX(-n.x),e.translateZ(-n.z),(new y.g).setFromObject(e)}},{key:"_transform",value:function(e){return e/100}}])&&D(t.prototype,n),a&&D(t,a),e}();function L(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var R=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.textures={},this._loadTextures(this.textures)}var t,n,a;return t=e,(n=[{key:"_loadTextures",value:function(e){var t=new y.Ob,n=t.load("assets/textures/floor_tiles_06_diff_1k.png");n.wrapS=n.wrapT=y.Ab,n.repeat.set(2,2),e.floor=n;var a=t.load("assets/textures/door_texture_3d_model_c4d_max_obj_fbx_ma_lwo_3ds_3dm_stl_963788_o.jpg");a.wrapS=a.wrapT=y.Ab,a.repeat.set(1,1),e.door=a}},{key:"getTexture",value:function(e){return this.textures[e]}}])&&L(t.prototype,n),a&&L(t,a),e}();function F(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function U(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var G=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),y.m.enabled=!0;var a=new R;this._loadJSON(t.url,this._sceneImporter,t,n,a)}var t,n,a;return t=e,(n=[{key:"_generateFlat",value:function(e,t){return(new W).generate(e.rooms,e.doors,e.external_walls,t)}},{key:"_sceneImporter",value:function(e,t,n){t.userData.boundingBoxes=[];var a,r=F(n);try{for(r.s();!(a=r.n()).done;){var o=a.value;o.scale.set(e.size.x,e.size.y,e.size.z),o.translateX(e.translate.x),o.translateY(e.translate.y),o.translateZ(e.translate.z),o.geometry.computeBoundingBox(),o.updateMatrixWorld();var i=o.geometry.boundingBox.clone();i.applyMatrix4(o.matrixWorld),i.userData=o.userData,t.userData.boundingBoxes.push(i),t.add(o)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_loadJSON",value:function(e,t,n,a,r){var o=new y.x,i=this;o.load(e,(function(e){var o=i._generateFlat(JSON.parse(e.replaceAll("'",'"')),r);t(n,a,o)}),(function(e){console.log(e.loaded/e.total*100+"% loaded")}),(function(e){console.error("An error happened")}))}},{key:"_loadTexture",value:function(e,t){var n=this;(new y.Ob).load("assets/textures/floor_tiles_06_diff_1k.png ",(function(a){n._material=new y.ab({map:a,side:y.s}),n._loadJSON(e.url,n._sceneImporter,e,t,n._material)}),void 0,(function(e){console.error("An error happened.")}))}}])&&U(t.prototype,n),a&&U(t,a),e}(),Z=n(11),N=n(1),X=n(12),Y=n(13);function J(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function H(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var q=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._moveSpeed=.05/60,this._turnSpeed=4,this._avatar=t.scene,this._kForward=n,this._walk=!1,this._avatar.castShadow=!0;var a=new y.c(this._avatar);this._mixer=a,this._fade_duration=.4,this._stop_fade_duration=1.5,this._animations=this._getAnimations(this._mixer,t),this._startAnimation("idle",this._fade_duration),this._action=!1,this._action2=!1;var r=new y.i(.7,.5,.5),o=new y.ab({color:65280}),i=new y.Z(r,o);this._boundingBox=i,this._speakingState=!1,this._speakingNext=-1,this._animationNext=-1,this._phonemeDuration=.02}var t,n,a;return t=e,(n=[{key:"setSpeechManager",value:function(e){this._speechManager=e}},{key:"update",value:function(e,t,n){this._moveSpeed;var a=this._avatar,r=this._fade_duration,o=this._stop_fade_duration,i=(t.keys.up.down?1:0)+(t.keys.down.down?-1:0),s=(t.keys.left.down?1:0)+(t.keys.right.down?-1:0);if(0!==s&&a.rotateY(this._turnSpeed*s*e),0!==i){var u=i*e;a.translateOnAxis(this._kForward,u),this._walk||(this._stopAnimation("idle",r),this._startAnimation("walk",r),this._walk=!0),void 0!==this._findBoundingBox(a,1,n)&&a.translateOnAxis(this._kForward,-u)}else this._walk&&(this._stopAnimation("walk",r),this._startAnimation("idle",this._fade_duration),this._walk=!1);this._speakingState&&this._speakingAnimation();var l=this._findBoundingBox(a,0,n);if(t.keys.speak.down)if(!0!==this._speakingState){if(void 0!==l){var c=l.userData.roomId;console.log("roomId : "+c),this._speakAboutRoom(c),this._speakingState=!0}}else this._stopSpeak(),this._speakingState=!1;t.keys.action.down?!0!==this._action&&(this._stopAnimation("idle",r),this._startAnimation("pointing",r),this._action=!0):!0===this._action&&(this._startAnimation("idle",r),this._stopAnimation("pointing",o),this._action=!1),t.keys.action2.down?!0!==this._action2&&(this._stopAnimation("idle",r),this._startAnimation("gesture",r),this._action2=!0):!0===this._action2&&(this._startAnimation("idle",r),this._stopAnimation("gesture",o),this._action2=!1),this._mixer.update(e)}},{key:"_getAnimations",value:function(e,t){var n=t.animations,a=e.clipAction(n[6]),r=e.clipAction(n[0]),o=e.clipAction(n[8]),i=e.clipAction(n[4]),s=e.clipAction(n[10]),u=e.clipAction(n[12]),l=[];l.pointing=a,l.gesture=r,l.startWalk=o,l.endWalk=i,l.walk=s,l.idle=u;var c=e.clipAction(this._makeJaw());return c.setLoop(y.T,2),l.jaw=c,l}},{key:"_startAnimation",value:function(e,t){this._animations[e].reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(t).play()}},{key:"_stopAnimation",value:function(e,t){this._animations[e].fadeOut(t)}},{key:"_makeJaw",value:function(){var e=new y.Vb(0,0,1),t=new y.tb(0,0,-.8664570450782776,.4992516338825226),n=(new y.tb).setFromAxisAngle(e,-Math.PI),a=new y.ub("jaw.quaternion",[0,1,2],[t.x,t.y,t.z,t.w,n.x,n.y,n.z,n.w,t.x,t.y,t.z,t.w]);return new y.b("Action",.5,[a])}},{key:"_speakAboutRoom",value:function(e){var t=this;void 0!==this._speechManager&&this._speechManager.say(e,(function(e){"stop"===e&&t._stopSpeak(),"speak"===e&&t._startSpeak()}))}},{key:"_stopSpeak",value:function(){void 0!==this._speechManager&&this._speechManager.mute(),this._speakingState=!1,this._stopAnimation("jaw",.02),this._stopAnimation("gesture",3),this._stopAnimation("pointing",3)}},{key:"_startSpeak",value:function(){this._speakingState=!0,this._speakingNext=Date.now(),this._animationNext=Date.now()}},{key:"_speakingAnimation",value:function(){if(this._speakingNext<Date.now()&&(this._startAnimation("jaw",this._phonemeDuration),this._speakingNext=Date.now()+Math.floor(Math.random()*this._phonemeDuration*3e4)),this._animationNext<Date.now()){var e=this._randomAnimation(["gesture","pointing"]);this._startAnimation(e,3),this._animationNext=Date.now()+Math.floor(3*Math.random()*3e4)}}},{key:"_randomAnimation",value:function(e){return Math.random()<.5?e[0]:e[1]}},{key:"_findBoundingBox",value:function(e,t,n){this._boundingBox.position.x=e.position.x,this._boundingBox.position.y=t,this._boundingBox.position.z=e.position.z,this._boundingBox.geometry.computeBoundingBox(),this._boundingBox.updateMatrixWorld();var a=this._boundingBox.geometry.boundingBox.clone();a.applyMatrix4(this._boundingBox.matrixWorld);var r,o=J(n);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(i.intersectsBox(a))return i}}catch(e){o.e(e)}finally{o.f()}}}])&&H(t.prototype,n),a&&H(t,a),e}();function K(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function ee(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var te=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._loaded=!1,this._scene=t,this._sceneElements=n}var t,n,a;return t=e,(n=[{key:"loadScenePromises",value:function(){var e,t=this,n=[],a=K(t._sceneElements);try{var r=function(){var a=e.value,r=new Promise((function(e,n){t._loadSceneElement(t._scene,a,e,n)}));n.push(r)};for(a.s();!(e=a.n()).done;)r()}catch(e){a.e(e)}finally{a.f()}return n}},{key:"loadScenePromise",value:function(){var e=this;return new Promise((function(t){var n=e.loadScenePromises();Promise.all(n).then((function(e){console.log("success",e);var n,a={result:"success"},r=K(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;a=Object.assign(o,a)}}catch(e){r.e(e)}finally{r.f()}t(a)})).catch((function(e){console.log("error",e),t({result:"error"+e})}))}))}},{key:"_loadSceneElement",value:function(e,t,n,a){try{var r=t.url.toLowerCase();r.endsWith("json")?(new G(t,e),n({})):r.endsWith("gltf")||r.endsWith("glb")?this._loadGLTF(e,t,(function(e){n(e)})):r.endsWith("fbx")?this._loadFBX(config,e):r.endsWith("vrm")?this._loadVRM(config,e):r.endsWith("bvh")?this._loadBVH(config,e):(console.log("Unknown format! "+r),a("Unknown format! "+r))}catch(e){a("Exc! "+e)}}},{key:"_loadGLTF",value:function(e,t,n){var a=new N.a,r=this._processScene,o=(this._searchAnimations,this);a.load(t.url,(function(a){var i=r(a.scene),s=void 0;if(t.isAvatar){new y.Fb(i);var u=new y.Vb(0,0,1);s=new q(a,u)}var l=o._fixObject(t.translate,o._resizeObject(t.size,i));e.add(l),n({avatar:{manager:s}})}),void 0,(function(e){console.error(e)}))}},{key:"_ddd",value:function(){if(config.animated){var e=new y.Fb(gltf_scene);e.visible=!1,scene.add(e),console.log(e);var t=new y.c(gltf.scene);main_instance._mixer=t,main_instance.bones=[];var n=gltf.animations;console.log(n);var a=t.clipAction(n[6]),r=t.clipAction(n[0]),o=t.clipAction(n[8]),i=t.clipAction(n[4]),s=t.clipAction(n[10]),u=t.clipAction(n[12]);main_instance.durations=[],main_instance.durations.pointing=n[6].duration,main_instance.durations.gesture=n[0].duration,main_instance.durations.walk=n[10].duration,main_instance.durations.startWalk=n[8].duration,main_instance.durations.endWalk=n[4].duration,main_instance.durations.idle=n[12].duration,main_instance.animations=[],main_instance.animations.pointing=a,main_instance.animations.gesture=r,main_instance.animations.startWalk=o,main_instance.animations.endWalk=i,main_instance.animations.walk=s,main_instance.animations.idle=u;var l=config.animatedCycle;void 0!==l&&(main_instance._lastAnimationPhase=Date.now(),main_instance._animatedCycle=l,main_instance._animatedCyclePos=0,main_instance.animations[l[main_instance._animatedCyclePos].animation].play())}}},{key:"_loadBVH",value:function(e,t){var n=this;(new Z.a).load(e.scene.url,(function(a){console.log(a);var r=new y.Fb(a.skeleton.bones[0]);r.skeleton=a.skeleton;var o=new y.C;o.add(a.skeleton.bones[0]),t.add(n._resizeObject(e.scene.size,r)),t.add(n._resizeObject(e.scene.size,o));var i=new y.c(r);i.clipAction(a.clip).setEffectiveWeight(1).play(),n._setMixer(i)}))}},{key:"_loadVRM",value:function(e,t){(new N.a).load(e.scene.url,(function(e){X.a.from(e).then((function(e){console.log(e.meta),t.add(e.scene),console.log(e)}))}),(function(e){return console.log("Loading model...",e.loaded/e.total*100,"%")}),(function(e){return console.error(e)}))}},{key:"_fixObject",value:function(e,t){return t.translateX(e.x),t.translateY(e.y),t.translateZ(e.z),t}},{key:"_resizeObject",value:function(e,t){var n=(new y.g).setFromObject(t).getSize(new y.Vb);return Math.max(n.x,n.y,n.z),Math.max(e.x,e.y,e.z),t.scale.set(e.x,e.y,e.z),t}},{key:"_loadFBX",value:function(e,t){var n=new Y.a,a=this;n.load(e.scene.url,(function(n){var r=new y.Fb(n);r.visible=!0,t.add(r);var o=new y.c(n);console.log(n.animations),o.clipAction(n.animations[0]).play(),n.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),t.add(a._resizeObject(e.scene.size,n)),a._setMixer(o)}))}},{key:"_searchAnimations",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._searchAnimations;void 0!==e&&void 0!==e.children&&e.children.forEach((function(e){var n=e.animations;void 0!==n&&console.log(n),t(e,t)}))}},{key:"_processScene",value:function(e){var t=e,n=(new y.g).setFromObject(t),a=n.getCenter(new y.Vb),r=n.getSize(new y.Vb),o=Math.max(r.x,r.y,r.z);return t.scale.multiplyScalar(1.8/o),n.setFromObject(t),n.getCenter(a),n.getSize(r),t.position.copy(a).multiplyScalar(-1),t.position.y+=.5*r.y,e}}])&&ee(t.prototype,n),a&&ee(t,a),e}();function ne(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ae(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ae(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function re(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ie=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;re(this,e),this._container=t,this._config=Object.assign({fog:{color:5263440,near:8e-4},camera:{fov:60,near:.001,far:1e3,aspect:1,posX:0,posY:1.8,posZ:10.2},controls:{autoRotate:!1,autoRotateSpeed:-.5,rotateSpeed:.5,zoomSpeed:.8,minDistance:.01,maxDistance:600,minPolarAngle:Math.PI/5,maxPolarAngle:Math.PI/2,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0,enableDamping:!0,dampingFactor:.5,enableZoom:!0,target:{x:0,y:1.8,z:0}},scene:[],isDev:!1},n),this._config.isDev&&console.log(this._config),this._speechManager=a}var t,n,a;return t=e,(n=[{key:"start",value:function(e){var t=this,n=this._config;this._scene=this.createScene(n);var a=this._scene;this._renderer=new w(n,a,this._container),this._camera=new k(n,this._renderer.threeRenderer),this._controls=new A(n,this._camera.threeCamera,this._container);var r=new y.a(4210752,3);a.add(r),n.isDev&&this._addDeveloper(a),n.sky&&new P(a),this._inputManager=new j,this._avatarManager=void 0;var o=new te(a,n.scene,e).loadScenePromises(),i=o.length;e(0,"Start loading"),Promise.all(o).then((function(n){console.log("success",n);var a,r=0,o=ne(n);try{for(o.s();!(a=o.n()).done;){var s=a.value;void 0!==s.avatar&&(t._avatarManager=s.avatar.manager,t._avatarManager.setSpeechManager(t._speechManager)),r++,e(Math.floor(r/i),"")}}catch(e){o.e(e)}finally{o.f()}e(100,"load done.")})).catch((function(t){console.log("error",t),e(-1,"Error.")}))}},{key:"run",value:function(){this.render()}},{key:"createScene",value:function(e){var t=new y.Bb;return window.devicePixelRatio&&(e.dpr=window.devicePixelRatio),t.fog=new y.z(e.fog.color,e.fog.near),t}},{key:"render",value:function(){this._renderer.render(this._scene,this._camera.threeCamera),this._controls.threeControls.update();var e=(Date.now()-this._lastframe)/1e3;void 0!==this._mixer&&this._mixer.update(e),this._lastframe=Date.now(),this._inputManager.update(),void 0!==this._avatarManager&&this._avatarManager.update(e,this._inputManager,this._scene.userData.boundingBoxes),requestAnimationFrame(this.render.bind(this))}},{key:"_animateCycle",value:function(){if(void 0!==this._animatedCycle){var e=this._animatedCycle[this._animatedCyclePos],t=e.time;void 0===t&&(t=this._getDuration());var n=1e3*t,a=Date.now();if(void 0!==e.speed){var r=dt*e.speed;this._action_figure.translateZ(r)}a-this._lastAnimationPhase>n&&(this._getAnimation().fadeOut(.4),this._animatedCyclePos=this._animatedCyclePos+1,this._animatedCyclePos>this._animatedCycle.length-1&&(this._animatedCyclePos=0),this._lastAnimationPhase=a,this._getAnimation().reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(.4).play(),console.log(this._animatedCyclePos))}}},{key:"_setMixer",value:function(e){this._mixer=e}},{key:"_getAnimation",value:function(){return this.animations[this._getAnimationName()]}},{key:"_getDuration",value:function(){return this.durations[this._getAnimationName()]}},{key:"_getAnimationName",value:function(){return this._animatedCycle[this._animatedCyclePos].animation}},{key:"_addDeveloper",value:function(e){var t=new y.M(new O.a(6,6,6,10,10,10),new y.K({color:8388608}));t.geometry.translate(0,3,0),e.add(t)}}])&&oe(t.prototype,n),a&&oe(t,a),e}();n(23);console.log("Start sequor.edu");var se=new r,ue=new i(document),le=new p(document);if(se.webgl()){ue.showLoading();var ce=document.getElementById("appContainer");fetch("./assets/config.json").then((function(e){return e.json()})).then((function(e){console.log(e);var t=new ie(ce,{sky:!1,scene:e},le);t.start((function(e,n){ue.progress(e,n),e>99&&(ue.hideLoading(),t.run())}))}))}else ue.hideLoading(),se.addGetWebGLMessage({parent:document.getElementById("appContainer"),id:"webgl-error"})}},[[14,1,2]]]);